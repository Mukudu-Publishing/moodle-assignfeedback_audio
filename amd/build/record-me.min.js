define ("assignfeedback_audio/record-me",["jquery","core/str","core/notification"],function(a,b,c){return{init:function init(d,f,g,h){if(navigator.mediaDevices.getUserMedia){var i,j,k,l,m,n,o,p,q,r;b.get_strings([{key:"ok",component:"assignfeedback_audio"},{key:"pluginname",component:"assignfeedback_audio"},{key:"stoprecordingprompt",component:"assignfeedback_audio"},{key:"stoplisteningprompt",component:"assignfeedback_audio"},{key:"maxtimeallowedreached",component:"assignfeedback_audio"},{key:"feedbackremoved",component:"assignfeedback_audio"},{key:"nomediarecordingsupport",component:"assignfeedback_audio"},{key:"nomicrophineallowed",component:"assignfeedback_audio"},{key:"mediasavefailed",component:"assignfeedback_audio"},{key:"medianocapture",component:"assignfeedback_audio"}]).done(function(a){i=a[0];j=a[0];k=a[2];l=a[3];m=a[4];n=a[5];o=a[6];p=a[7];q=a[8];r=a[9]});var s=!1;navigator.permissions.query({name:"microphone"}).then(function(a){if(a&&"denied"==a.state){s=!0;t(p)}}).catch(function(){});var t=function(b){a(".feedbackinfoarea").css("display","block");a(".feedbackinfoarea").text(b)},u=function(b){if("error"==b.status){c.alert(j,b.message,i)}else{a("#id_fileref").val(b.fileref)}},v=function(){if(0<w.length){y=new Blob(w,{type:x});var b=new FormData;b.append("action","save");b.append("audiofile",y);b.append("gradeid",g);b.append("contextid",h);a.ajax(d,{method:"POST",contentType:!1,processData:!1,dataType:"json",data:b,error:function error(){c.alert(j,q,i)},success:u})}else{c.alert(j,r,i)}},w=[],x="audio/webm",y,z,A,B=15,C=document.getElementsByName("startbtn")[0];if(!s){C.disabled=!1}var D=document.getElementsByName("stopbtn")[0],E=document.getElementsByName("listenbtn")[0],F=document.getElementsByName("deletebtn")[0];a(".startbtn").click(function(){C.disabled=!0;D.disabled=!1;E.disabled=!0;F.disabled=!0;if(0<w.length){w=[]}navigator.mediaDevices.getUserMedia({audio:!0}).then(function(b){A=new MediaRecorder(b,{mimeType:x});A.addEventListener("dataavailable",function(b){if(0<b.data.size){w.push(b.data);if(w.length>=f/B){c.alert(j,m,i);a(".stopbtn").click()}}});A.addEventListener("stop",v);A.start(1e3*B)})});a(".stopbtn").click(function(){D.disabled=!0;C.disabled=!1;E.disabled=!1;F.disabled=!1;if("recording"==A.state){A.stop()}else{if(z.src){z.pause()}}D.textContent=k});a(".listenbtn").click(function(){E.disabled=!0;D.disabled=!1;C.disabled=!0;F.disabled=!0;D.textContent=l;var b=URL.createObjectURL(y);z=new Audio(b);z.addEventListener("canplaythrough",function(){z.play()});z.addEventListener("ended",function(){a(".stopbtn").click()})});a(".deletebtn").click(function(){C.disabled=!1;E.disabled=!0;D.disabled=!0;F.disabled=!0;w=[];y=null;a("#id_fileref").val("");c.alert(j,n,i)})}else{t(o)}}}});
//# sourceMappingURL=record-me.min.js.map
